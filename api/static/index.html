<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ember Starter Kit</title>
    <link rel="stylesheet" href="/admin/css/normalize.css">
    <link rel="stylesheet" href="/admin/css/style.css">
    <link rel="stylesheet" href="/admin/css/bootstrap.min.css">
    <link rel="stylesheet" href="/admin/css/jquery.datetimepicker.css">
    <style>
      .user-list {
      max-height: 200px;
      overflow: auto;
      }
      .is-current-user { font-weight: bold; }
    </style>
  </head>
  <body>
    <script type="text/x-handlebars">
      <nav class="navbar navbar-default" role="navigation">
	<div class="container-fluid">
	  <!-- Brand and toggle get grouped for better mobile display -->
	  <div class="navbar-header">
	    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
	    </button>
	    <a class="navbar-brand" href="#">Brand</a>
	  </div>

	  <!-- Collect the nav links, forms, and other content for toggling -->
	  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	    <ul class="nav navbar-nav">
	      <li>{{#link-to 'picks.viewCurrent'}}Picks{{/link-to}}</li>
              <li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin <span class="caret"></span></a>
		<ul class="dropdown-menu" role="menu">
		  <li>{{#link-to 'weeks'}}Week Editor{{/link-to}}</li>
		  <li>{{#link-to 'schools'}}Schools{{/link-to}}</li>
		  <li>{{#link-to 'users'}}Users{{/link-to}}</li>
		</ul>
              </li>
	    </ul>
	    <!--
	    <form class="navbar-form navbar-left" role="search">
              <div class="form-group">
		<input type="text" class="form-control" placeholder="Search">
              </div>
              <button type="submit" class="btn btn-default">Submit</button>
	    </form>
	    <ul class="nav navbar-nav navbar-right">
              <li><a href="#">Link</a></li>
              <li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <span class="caret"></span></a>
		<ul class="dropdown-menu" role="menu">
		  <li><a href="#">Action</a></li>
		  <li><a href="#">Another action</a></li>
		  <li><a href="#">Something else here</a></li>
		  <li class="divider"></li>
		  <li><a href="#">Separated link</a></li>
		</ul>
              </li>
	    </ul>
	    -->
	  </div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
      </nav>

      {{outlet}}
    </script>
    
  <script type="text/x-handlebars" id="index">
    Main index
  </script>

  <script type="text/x-handlebars" data-template-name="picks/edit">
    {{#if week.editable}}
    {{#if showSavedDialog}}
    <div>Picks saved</div>
    {{/if}}
    
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <table class="table">
	<thead>
	  <tr>
	    <th>Matchup</th>
	    <th>Line</th>
	    <th>Winner</th>
	    <th>Points</th>
	  </tr>
	</thead>
	<tbody>
	  {{#each}}
	  <tr>
	    <td>{{matchup.awayTeam.abbreviation}} at {{matchup.homeTeam.abbreviation}}</td>
	    <td>{{matchup.line}}
	    <td>{{view Ember.Select content=teams value=winner
	      prompt="Choose a winner" optionLabelPath="content.name"
	      class="form-control"}}</td>
	    <td>{{input value=points class="form-control"}}</td>
	  </tr>
	  {{/each}}
	  <tr>
	    <td></td><td></td><td></td><td align="right">Total: {{totalPoints}}</td>
	  </tr>
	  {{#if isAdmin}}
	  <tr>
	    <td>As user:</td>
	    <td colspan="3">{{view Ember.Select content=users value=userOverride
	      optionLabelPath="content.name" class="form-control"}}</td>
	  </tr>
	  {{/if}}
	  <tr>
	    <td colspan="4">
	      <button type="submit" class="btn btn-default">Save</button>
	    </td>
	  </tr>
	</tbody>
      </table>

    </form>
    {{else}}
    Picks can no longer be submitted.
    {{/if}}
  </script>

  <script type="text/x-handlebars" data-template-name="picks/view">
    <div class="table-responsive">
      <table class="table table-striped">
	<thead>
	  <tr>
	    <th>Name</th>
	    {{#each matchups}}
	    <th colspan="2">{{awayTeam.abbreviation}} vs. {{homeTeam.abbreviation}}<br/>{{line}}</th>
	    {{/each}}
	    <th>Total<br/>Points</th>
	    <th>Total<br/>Games</th>
	  <tr>
	</thead>

	<tbody>
	  {{#each userBets}}
	  <tr>
	    <td {{bind-attr class="isCurrentUser"}}>{{name}}</td>
	    {{#each bets}}
	    <td {{bind-attr style="colors"}}>{{winner.abbreviation}}</td>
	    <td align="right" {{bind-attr style="colors"}}>{{points}}</td>
	    {{/each}}
	    <td align="right">{{totalPoints}}</td>
	    <td align="right">{{gamesWon}}</td>
	  </tr>
	  {{/each}}
	</tbody>
      </table>
    </div>
  </script>

  <script type="text/x-handlebars" data-template-name="weeks">
    <form class="form-search" role="form" {{action search on="submit"}}>
      {{input value=query id="search-search" class="input-medium search-query" placeholder="Season"}}
      <button type="submit" class="btn btn-default">Search</button>
    </form>
    
    {{outlet}}
  </script>

  <script type="text/x-handlebars" data-template-name="weeks/index">
    <table class="table table-striped">
      <thead>
	<tr>
	  <th>Week</th>
	  <th>Start Date</th>
	  <th>End Date</th>
	  <th>Deadline</th>
	  <th>Matchups</th>
	  <th></th>
	<tr>
      </thead>
      <tbody>
	{{#each}}
	<tr>
	  <td>{{number}}</td>
	  <td>{{display-datetime startDate 1}}</td>
	  <td>{{display-datetime endDate 1}}</td>
	  <td>{{display-datetime deadline 0}}</td>
	  <td>{{matchups.length}}</td>
	  <td><button class="btn btn-default" {{action "editWeek" this}}>Edit</button></td>
	</tr>
	{{/each}}
      </tbody>
    </table>
    <button class="btn btn-default" {{action 'newWeek'}}>Add week</button>
  </script>

  <script type="text/x-handlebars" data-template-name="weeks/_form">
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <div class="form-group">
	<label for="season" class="col-sm-2 control-label">Season</label>
	<div class="col-sm-10">
	  {{input value=season id="season" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="number" class="col-sm-2 control-label">Week Number</label>
	<div class="col-sm-10">
	  {{input value=number id="number" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="startDate" class="col-sm-2 control-label">Start Date</label>
	<div class="col-sm-10">
	  {{view "datePicker" value=startDate id="startDate" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="endDate" class="col-sm-2 control-label">End Date</label>
	<div class="col-sm-10">
	  {{view "datePicker" value=endDate id="endDate" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="deadline" class="col-sm-2 control-label">Deadline</label>
	<div class="col-sm-10">
	  {{view "dateTimePicker" value=deadline id="deadline" class="form-control"}}
	</div>
      </div>

      <table class="table table-striped">
	<thead>
	  <tr>
	    <th>Away Team</th>
	    <th>Home Team</th>
	    <th>Line</th>
	    <th>Kickoff</th>
	    <th></th>
	</thead>
	<tbody>
	  {{view Ember.CollectionView itemViewClass="App.MatchupEditor" content=matchups}}
	  <tr>
	    <td colspan="5">
	      <button class="btn btn-default" {{action "newMatchup"}}>+</button>
	    </td>
	  </tr>
	</tbody>
      </table>

      {{#if isNotNew}}
      <ul class="list-group user-list">
	{{#each toggleableUsers}}
	<li class="list-group-item">{{name}} {{input type="checkbox" checked=active}}</li>
	{{/each}}
      </ul>
      {{/if}}
      
      <div class="form-group">
	<div class="col-sm-offset-2 col-sm-10">
	  <button type="submit" class="btn btn-default">Save</button>
	</div>
      </div>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name="matchup-editor">
    <tr>
      <td>
	<div class="col-sm-10">
	  {{view Ember.Select value=view.content.awayTeam content=schools
	  optionValuePath="content" optionLabelPath="content.name"
	  prompt="Choose away team" class="form-control"}}
	</div>
      </td>
      <td>
	<div class="col-sm-10">
	  {{view Ember.Select value=view.content.homeTeam content=schools
	  optionValuePath="content" optionLabelPath="content.name"
	  prompt="Choose home team" class="form-control"}}
	</div>
      </td>
      <td>
	<div class="col-sm-10">
	  {{input value=view.content.line class="form-control"}}
	</div>
      </td>
      <td>
	<div class="col-sm-10">
	  {{view "dateTimePicker" value=view.content.kickoff class="form-control"}}
	</div>
      </td>
      <td>
	<div class="col-sm-10">
	  <button class="btn btn-default" {{action "removeMatchup" view.content}}>-</button>
	</div>
      </td>
    </tr>
  </script>

  <script type="text/x-handlebars" data-template-name="matchups">
    <h2>Matchups</h2>
    {{outlet}}
  </script>

  <script type="text/x-handlebars" data-template-name="scores/edit">
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <table class="table">
	<thead>
	  <tr>
	    <th colspan="2">Away</th>
	    <th colspan="2">Home</th>
	    <th>Line</th>
	  </tr>
	</thead>
	<tbody>
	  {{#each}}
	  <tr>
	    <td>{{awayTeam.name}}</td>
	    <td>{{input class="form-control" value=awayScore}}</td>
	    <td>{{homeTeam.name}}</td>
	    <td>{{input class="form-control" value=homeScore}}</td>
	    <td {{bind-attr class="coveredColor"}}>{{line}}</td>
	  </tr>
	  {{/each}}
	</tbody>
      </table>
      <button type="submit" class="btn btn-default">Save</button>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name="matchups/index">
    <table class="table table-striped">
      <thead>
	<tr>
	  <th></th>
	  <th>Away Team</th>
	  <th>Home Team</th>
	  <th>Line</th>
	  <th>Kickoff</th>
	<tr>
      </thead>
      <tbody>
	{{#each matchup in model}}
	<tr>
	  <td>{{#link-to 'matchups.edit' matchup}}Edit{{/link-to}}</td>
	  <td>{{matchup.awayTeam.name}}</td>
	  <td>{{matchup.homeTeam.name}}</td>
	  <td>{{matchup.line}}</td>
	  <td>{{matchup.kickoff}}</td>
	</tr>
	{{/each}}
      </tbody>
    </table>
    <button class="btn btn-default" {{action 'newMatchup'}}>New</button>
  </script>

  <script type="text/x-handlebars" data-template-name="matchups/_form">
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <div class="form-group">
	<label for="awayTeam" class="col-sm-2 control-label">Away Team</label>
	<div class="col-sm-10">
	  {{view Ember.Select value=awayTeam content=schools optionValuePath="content"
	  optionLabelPath="content.name" prompt="Choose away team"
	  id="awayTeam" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="homeTeam" class="col-sm-2 control-label">Home Team</label>
	<div class="col-sm-10">
	  {{view Ember.Select value=homeTeam content=schools optionValuePath="content"
	  optionLabelPath="content.name" prompt="Choose home team"
	  id="homeTeam" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="line" class="col-sm-2 control-label">Line</label>
	<div class="col-sm-10">
	  {{input value=line id="line" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="kickoff" class="col-sm-2 control-label">Kickoff Time</label>
	<div class="col-sm-10">
	  {{input value=kickoff id="kickoff" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<div class="col-sm-offset-2 col-sm-10">
	  <button type="submit" class="btn btn-default">Save</button>
	</div>
      </div>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name="schools">
    <h2>Schools</h2>
    {{outlet}}
  </script>

  <script type="text/x-handlebars" data-template-name="schools/index">
    <table class="table table-striped">
      <thead>
	<tr>
	  <th>Name</th>
	  <th>Abbreviation</th>
	  <th>Mascot</th>
	<tr>
      </thead>
      <tbody>
	{{#each}}
	<tr>
	  <td>{{#link-to 'schools.edit' this}}{{name}}{{/link-to}}</td>
	  <td>{{abbreviation}}</td>
	  <td>{{mascot}}</td>
	</tr>
	{{/each}}
      </tbody>
    </table>
    <button class="btn btn-default" {{action 'newSchool'}}>New School</button>
  </script>

  <script type="text/x-handlebars" data-template-name="schools/_form">
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <div class="form-group">
	<label for="name" class="col-sm-2 control-label">Name</label>
	<div class="col-sm-10">
	  {{input value=name id="name" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="fullName" class="col-sm-2 control-label">Full Name</label>
	<div class="col-sm-10">
	  {{input value=this.fullName id="fullName" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="abbrev" class="col-sm-2 control-label">Abbreviation</label>
	<div class="col-sm-10">
	  {{input value=this.abbreviation id="abbrev" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="mascot" class="col-sm-2 control-label">Mascot</label>
	<div class="col-sm-10">
	  {{input value=this.mascot id="mascot" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="primaryColor" class="col-sm-2 control-label">Primary Color</label>
	<div class="col-sm-10">
	  {{input value=this.primaryColor id="primaryColor" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<label for="secondaryColor" class="col-sm-2 control-label">Secondary Color</label>
	<div class="col-sm-10">
	  {{input value=this.secondaryColor id="secondaryColor" class="form-control"}}
	</div>
      </div>
      <div class="form-group">
	<div class="col-sm-offset-2 col-sm-10">
	  <button type="submit" class="btn btn-default">Save</button>
	</div>
      </div>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name="users">
    <form class="form-horizontal" role="form" {{action save on="submit"}}>
      <table class="table table-striped">
	<thead>
	  <tr>
	    <th>Name</th>
	    <th>Email</th>
	    <th>Order</th>
	    <th>Active</th>
	    <th>Admin</th>
	  <tr>
	</thead>
	<tbody>
	  {{#each}}
	  <tr>
	    <td>
	      {{#if isEditing}}
	      {{input value=name focus-out="doneEditing"}}
	      {{else}}
	      <span {{action "editUser" on="click"}}>{{name}}</span>
	      {{/if}}
	    </td>
	    <td>
	      {{#if isEditing}}
	      {{input value=email focus-out="doneEditing"}}
	      {{else}}
	      <span {{action "editUser" on="click"}}>{{email}}</span>
	      {{/if}}
	    </td>
	    <td>
	      {{#if isEditing}}
	      {{input value=order focus-out="doneEditing"}}
	      {{else}}
	      <span {{action "editUser" on="click"}}>{{order}}</span>
	      {{/if}}
	    </td>
	    <td>{{input type="checkbox" checked=active}}</td>
	    <td>{{input type="checkbox" checked=admin}}</td>
	  </tr>
	  {{/each}}
	</tbody>
      </table>
      <button type="submit" class="btn btn-default">Save</button>
      <button class="btn btn-default" {{action 'newUser'}}>New User</button>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name="tokens">
    <h2>{{season}} Week {{number}}</h2>
    <table class="table table-striped">
      <thead>
	<th>User</th>
	<th>Email</th>
	<th>Token</th>
      </thead>
      <tbody>
	{{#each users}}
	<tr>
	  <td>{{name}}</td>
	  <td>{{email}}</td>
	  <td>
	    {{#if token}}
	    {{#link-to 'auth' token}}{{token}}{{/link-to}}
	    {{else}}
	    ********
	    {{/if}}
	  </td>
	</tr>
	{{/each}}
      </tbody>
    </table>

    <button class="btn btn-default" {{action 'fetchTokens'}}>Fetch tokens</button>
  </script>
  
  <script src="/admin/js/libs/jquery-1.10.2.js"></script>
  <script src="/admin/js/libs/moment.js"></script>
  <script src="/admin/js/libs/moment-timezone-with-data-2010-2020.js"></script>
  <script src="/admin/js/libs/handlebars-1.1.2.js"></script>
  <script src="/admin/js/libs/ember-1.6.1.js"></script>
  <script src="/admin/js/libs/ember-data.js"></script>
  <script src="/admin/js/libs/bootstrap.js"></script>
  <script src="/admin/js/libs/jquery.datetimepicker.js"></script>
  <script src="/admin/js/compat.js"></script>
  <script src="/admin/js/app.js"></script>
</body>
</html>
